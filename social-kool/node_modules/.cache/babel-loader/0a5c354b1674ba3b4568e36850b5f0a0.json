{"ast":null,"code":"import _slicedToArray from \"/Users/agustdmybae/Desktop/web-projects/social-kool/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/agustdmybae/Desktop/web-projects/social-kool/src/pages/NewPost.js\";\nimport React from \"react\";\nimport firebase from \"../utils/firebase\";\nimport 'firebase/compat/firestore';\nimport 'firebase/compat/storage';\nimport { Container, Header, Form, Image, Button } from \"semantic-ui-react\";\nimport { useNavigate } from 'react-router-dom';\nexport default function NewPost() {\n  var navigate = useNavigate();\n  var _React$useState = React.useState(\"\"),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    title = _React$useState2[0],\n    setTitle = _React$useState2[1];\n  var _React$useState3 = React.useState(\"\"),\n    _React$useState4 = _slicedToArray(_React$useState3, 2),\n    content = _React$useState4[0],\n    setContent = _React$useState4[1];\n  var _React$useState5 = React.useState([]),\n    _React$useState6 = _slicedToArray(_React$useState5, 2),\n    topics = _React$useState6[0],\n    setTopics = _React$useState6[1];\n  var _React$useState7 = React.useState(\"\"),\n    _React$useState8 = _slicedToArray(_React$useState7, 2),\n    topicName = _React$useState8[0],\n    setTopicName = _React$useState8[1];\n  var _React$useState9 = React.useState(null),\n    _React$useState10 = _slicedToArray(_React$useState9, 2),\n    image = _React$useState10[0],\n    setImage = _React$useState10[1];\n  var _React$useState11 = React.useState(false),\n    _React$useState12 = _slicedToArray(_React$useState11, 2),\n    isLoading = _React$useState12[0],\n    setIsLoading = _React$useState12[1];\n  React.useEffect(function () {\n    firebase.firestore().collection(\"topics\").get().then(function (collectionSnapshot) {\n      var data = collectionSnapshot.docs.map(function (doc) {\n        return doc.data();\n      });\n      setTopics(data);\n    });\n  });\n  var options = topics.map(function (topic) {\n    return {\n      text: topic.name,\n      value: topic.name\n    };\n  });\n  var previewURL = image ? URL.createObjectURL(image) : \"https://react.semantic-ui.com/images/wireframe/image.png\";\n  //送出文章function\n  function onSubmit() {\n    setIsLoading(true);\n    var documentRef = firebase.firestore().collection(\"posts\").doc();\n    //取得圖片存放位置\n    var fileRef = firebase.storage().ref('post-images/' + documentRef.id);\n    //檔案的額外資訊\n    var metadata = {\n      contentType: image.type\n    };\n    //儲存圖片檔案\n    fileRef.put(image, metadata).then(function () {\n      fileRef.getDownloadURL().then(function (imageURL) {\n        documentRef.set({\n          title: title,\n          content: content,\n          topic: topicName,\n          createdAt: firebase.firestore.Timestamp.now(),\n          author: {\n            displayName: firebase.auth().currentUser.displayName || \"\",\n            photoURL: firebase.auth().currentUser.photoURL || \"\",\n            uid: firebase.auth().currentUser.uid,\n            email: firebase.auth().currentUser.email\n          },\n          imageURL: imageURL\n        }).then(function () {\n          setIsLoading(false);\n          navigate('/');\n        });\n      });\n    });\n  }\n  return /*#__PURE__*/React.createElement(Container, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Header, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 13\n    }\n  }, \"\\u767C\\u8868\\u6587\\u7AE0\"), /*#__PURE__*/React.createElement(Form, {\n    onSubmit: onSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Image, {\n    src: previewURL,\n    size: \"small\",\n    floated: \"left\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(Button, {\n    basic: true,\n    as: \"label\",\n    htmlFor: \"post-image\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 17\n    }\n  }, \"\\u4E0A\\u50B3\\u6587\\u7AE0\\u5716\\u7247\"), /*#__PURE__*/React.createElement(Form.Input, {\n    type: \"file\",\n    id: \"post-image\",\n    style: {\n      display: 'none'\n    },\n    onChange: function onChange(e) {\n      return setImage(e.target.files[0]);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(Form.Input, {\n    placeholder: \"\\u8F38\\u5165\\u6587\\u7AE0\\u6A19\\u984C\",\n    value: title,\n    onChange: function onChange(e) {\n      return setTitle(e.target.value);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(Form.TextArea, {\n    placeholder: \"\\u8F38\\u5165\\u6587\\u7AE0\\u5167\\u5BB9\",\n    value: content,\n    onChange: function onChange(e) {\n      return setContent(e.target.value);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(Form.Dropdown, {\n    placeholder: \"\\u9078\\u64C7\\u6587\\u7AE0\\u4E3B\\u984C\",\n    options: options,\n    selection: true,\n    value: topicName,\n    onChange: function onChange(e, _ref) {\n      var value = _ref.value;\n      return setTopicName(value);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(Form.Button, {\n    loading: isLoading,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 17\n    }\n  }, \"\\u9001\\u51FA\")));\n}","map":{"version":3,"names":["React","firebase","Container","Header","Form","Image","Button","useNavigate","NewPost","navigate","_React$useState","useState","_React$useState2","_slicedToArray","title","setTitle","_React$useState3","_React$useState4","content","setContent","_React$useState5","_React$useState6","topics","setTopics","_React$useState7","_React$useState8","topicName","setTopicName","_React$useState9","_React$useState10","image","setImage","_React$useState11","_React$useState12","isLoading","setIsLoading","useEffect","firestore","collection","get","then","collectionSnapshot","data","docs","map","doc","options","topic","text","name","value","previewURL","URL","createObjectURL","onSubmit","documentRef","fileRef","storage","ref","id","metadata","contentType","type","put","getDownloadURL","imageURL","set","createdAt","Timestamp","now","author","displayName","auth","currentUser","photoURL","uid","email","createElement","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","src","size","floated","basic","as","htmlFor","Input","style","display","onChange","e","target","files","placeholder","TextArea","Dropdown","selection","_ref","loading"],"sources":["/Users/agustdmybae/Desktop/web-projects/social-kool/src/pages/NewPost.js"],"sourcesContent":["import React from \"react\";\nimport firebase from \"../utils/firebase\";\nimport 'firebase/compat/firestore';\nimport 'firebase/compat/storage';\nimport { Container, Header, Form, Image, Button } from \"semantic-ui-react\";\nimport {useNavigate} from 'react-router-dom';\n\nexport default function NewPost(){\n    const navigate = useNavigate();\n    const [title, setTitle] = React.useState(\"\");\n    const [content, setContent] = React.useState(\"\");\n    const [topics, setTopics] = React.useState([]);\n    const [topicName, setTopicName] = React.useState(\"\");\n    const [image, setImage] = React.useState(null);\n    const [isLoading, setIsLoading] = React.useState(false);\n\n    React.useEffect(()=>{\n        firebase\n        .firestore()\n        .collection(\"topics\")\n        .get()\n        .then((collectionSnapshot)=>{\n            const data = collectionSnapshot.docs.map(doc=>{\n                return doc.data();\n            })\n            setTopics(data);\n        })\n    })\n\n    const options = topics.map(topic=>{\n        return({\n            text:topic.name,\n            value:topic.name,\n        }) \n    })\n\n    const previewURL = image ? URL.createObjectURL(image) : \"https://react.semantic-ui.com/images/wireframe/image.png\"\n    //送出文章function\n    function onSubmit(){\n        setIsLoading(true);\n        const documentRef = firebase.firestore().collection(\"posts\").doc();\n        //取得圖片存放位置\n        const fileRef = firebase.storage().ref('post-images/'+documentRef.id)\n        //檔案的額外資訊\n        const metadata = {\n            contentType: image.type,\n        }\n        //儲存圖片檔案\n        fileRef.put(image, metadata).then(()=>{\n            fileRef.getDownloadURL().then((imageURL)=>{\n                documentRef.set({\n                    title,\n                    content,\n                    topic: topicName,\n                    createdAt: firebase.firestore.Timestamp.now(),\n                    author:{\n                        displayName: firebase.auth().currentUser.displayName || \"\",\n                        photoURL: firebase.auth().currentUser.photoURL || \"\",\n                        uid: firebase.auth().currentUser.uid,\n                        email: firebase.auth().currentUser.email\n                    },\n                    imageURL,\n                }).then(()=>{\n                    setIsLoading(false);\n                    navigate('/');\n                })\n            })\n        });\n        \n\n    }\n\n    return (\n        <Container>\n            <Header>發表文章</Header>\n            <Form onSubmit={onSubmit}>\n                <Image src={previewURL} size=\"small\" floated=\"left\"/>\n                <Button basic as=\"label\" htmlFor=\"post-image\">上傳文章圖片</Button>\n                <Form.Input \n                    type=\"file\" \n                    id=\"post-image\" \n                    style={{display: 'none'}}\n                    onChange={(e)=>setImage(e.target.files[0])}\n                />\n                <Form.Input \n                    placeholder='輸入文章標題' \n                    value={title} \n                    onChange={(e)=>setTitle(e.target.value)}\n                />\n                <Form.TextArea\n                    placeholder='輸入文章內容' \n                    value={content} \n                    onChange={(e)=>setContent(e.target.value)}\n                />\n                <Form.Dropdown\n                    placeholder='選擇文章主題'\n                    options={options}\n                    selection\n                    value={topicName}\n                    onChange={(e, {value})=>setTopicName(value)}\n                />\n                <Form.Button loading={isLoading}>送出</Form.Button>\n            </Form>\n        </Container>\n    )\n}"],"mappings":";;AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,OAAOC,QAAQ,MAAM,mBAAmB;AACxC,OAAO,2BAA2B;AAClC,OAAO,yBAAyB;AAChC,SAASC,SAAS,EAAEC,MAAM,EAAEC,IAAI,EAAEC,KAAK,EAAEC,MAAM,QAAQ,mBAAmB;AAC1E,SAAQC,WAAW,QAAO,kBAAkB;AAE5C,eAAe,SAASC,OAAOA,CAAA,EAAE;EAC7B,IAAMC,QAAQ,GAAGF,WAAW,CAAC,CAAC;EAAC,IAAAG,eAAA,GACLV,KAAK,CAACW,QAAQ,CAAC,EAAE,CAAC;IAAAC,gBAAA,GAAAC,cAAA,CAAAH,eAAA;IAArCI,KAAK,GAAAF,gBAAA;IAAEG,QAAQ,GAAAH,gBAAA;EAAA,IAAAI,gBAAA,GACQhB,KAAK,CAACW,QAAQ,CAAC,EAAE,CAAC;IAAAM,gBAAA,GAAAJ,cAAA,CAAAG,gBAAA;IAAzCE,OAAO,GAAAD,gBAAA;IAAEE,UAAU,GAAAF,gBAAA;EAAA,IAAAG,gBAAA,GACEpB,KAAK,CAACW,QAAQ,CAAC,EAAE,CAAC;IAAAU,gBAAA,GAAAR,cAAA,CAAAO,gBAAA;IAAvCE,MAAM,GAAAD,gBAAA;IAAEE,SAAS,GAAAF,gBAAA;EAAA,IAAAG,gBAAA,GACUxB,KAAK,CAACW,QAAQ,CAAC,EAAE,CAAC;IAAAc,gBAAA,GAAAZ,cAAA,CAAAW,gBAAA;IAA7CE,SAAS,GAAAD,gBAAA;IAAEE,YAAY,GAAAF,gBAAA;EAAA,IAAAG,gBAAA,GACJ5B,KAAK,CAACW,QAAQ,CAAC,IAAI,CAAC;IAAAkB,iBAAA,GAAAhB,cAAA,CAAAe,gBAAA;IAAvCE,KAAK,GAAAD,iBAAA;IAAEE,QAAQ,GAAAF,iBAAA;EAAA,IAAAG,iBAAA,GACYhC,KAAK,CAACW,QAAQ,CAAC,KAAK,CAAC;IAAAsB,iBAAA,GAAApB,cAAA,CAAAmB,iBAAA;IAAhDE,SAAS,GAAAD,iBAAA;IAAEE,YAAY,GAAAF,iBAAA;EAE9BjC,KAAK,CAACoC,SAAS,CAAC,YAAI;IAChBnC,QAAQ,CACPoC,SAAS,CAAC,CAAC,CACXC,UAAU,CAAC,QAAQ,CAAC,CACpBC,GAAG,CAAC,CAAC,CACLC,IAAI,CAAC,UAACC,kBAAkB,EAAG;MACxB,IAAMC,IAAI,GAAGD,kBAAkB,CAACE,IAAI,CAACC,GAAG,CAAC,UAAAC,GAAG,EAAE;QAC1C,OAAOA,GAAG,CAACH,IAAI,CAAC,CAAC;MACrB,CAAC,CAAC;MACFnB,SAAS,CAACmB,IAAI,CAAC;IACnB,CAAC,CAAC;EACN,CAAC,CAAC;EAEF,IAAMI,OAAO,GAAGxB,MAAM,CAACsB,GAAG,CAAC,UAAAG,KAAK,EAAE;IAC9B,OAAO;MACHC,IAAI,EAACD,KAAK,CAACE,IAAI;MACfC,KAAK,EAACH,KAAK,CAACE;IAChB,CAAC;EACL,CAAC,CAAC;EAEF,IAAME,UAAU,GAAGrB,KAAK,GAAGsB,GAAG,CAACC,eAAe,CAACvB,KAAK,CAAC,GAAG,0DAA0D;EAClH;EACA,SAASwB,QAAQA,CAAA,EAAE;IACfnB,YAAY,CAAC,IAAI,CAAC;IAClB,IAAMoB,WAAW,GAAGtD,QAAQ,CAACoC,SAAS,CAAC,CAAC,CAACC,UAAU,CAAC,OAAO,CAAC,CAACO,GAAG,CAAC,CAAC;IAClE;IACA,IAAMW,OAAO,GAAGvD,QAAQ,CAACwD,OAAO,CAAC,CAAC,CAACC,GAAG,CAAC,cAAc,GAACH,WAAW,CAACI,EAAE,CAAC;IACrE;IACA,IAAMC,QAAQ,GAAG;MACbC,WAAW,EAAE/B,KAAK,CAACgC;IACvB,CAAC;IACD;IACAN,OAAO,CAACO,GAAG,CAACjC,KAAK,EAAE8B,QAAQ,CAAC,CAACpB,IAAI,CAAC,YAAI;MAClCgB,OAAO,CAACQ,cAAc,CAAC,CAAC,CAACxB,IAAI,CAAC,UAACyB,QAAQ,EAAG;QACtCV,WAAW,CAACW,GAAG,CAAC;UACZpD,KAAK,EAALA,KAAK;UACLI,OAAO,EAAPA,OAAO;UACP6B,KAAK,EAAErB,SAAS;UAChByC,SAAS,EAAElE,QAAQ,CAACoC,SAAS,CAAC+B,SAAS,CAACC,GAAG,CAAC,CAAC;UAC7CC,MAAM,EAAC;YACHC,WAAW,EAAEtE,QAAQ,CAACuE,IAAI,CAAC,CAAC,CAACC,WAAW,CAACF,WAAW,IAAI,EAAE;YAC1DG,QAAQ,EAAEzE,QAAQ,CAACuE,IAAI,CAAC,CAAC,CAACC,WAAW,CAACC,QAAQ,IAAI,EAAE;YACpDC,GAAG,EAAE1E,QAAQ,CAACuE,IAAI,CAAC,CAAC,CAACC,WAAW,CAACE,GAAG;YACpCC,KAAK,EAAE3E,QAAQ,CAACuE,IAAI,CAAC,CAAC,CAACC,WAAW,CAACG;UACvC,CAAC;UACDX,QAAQ,EAARA;QACJ,CAAC,CAAC,CAACzB,IAAI,CAAC,YAAI;UACRL,YAAY,CAAC,KAAK,CAAC;UACnB1B,QAAQ,CAAC,GAAG,CAAC;QACjB,CAAC,CAAC;MACN,CAAC,CAAC;IACN,CAAC,CAAC;EAGN;EAEA,oBACIT,KAAA,CAAA6E,aAAA,CAAC3E,SAAS;IAAA4E,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,gBACNnF,KAAA,CAAA6E,aAAA,CAAC1E,MAAM;IAAA2E,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,GAAC,0BAAY,CAAC,eACrBnF,KAAA,CAAA6E,aAAA,CAACzE,IAAI;IAACkD,QAAQ,EAAEA,QAAS;IAAAwB,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,gBACrBnF,KAAA,CAAA6E,aAAA,CAACxE,KAAK;IAAC+E,GAAG,EAAEjC,UAAW;IAACkC,IAAI,EAAC,OAAO;IAACC,OAAO,EAAC,MAAM;IAAAR,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,CAAC,CAAC,eACrDnF,KAAA,CAAA6E,aAAA,CAACvE,MAAM;IAACiF,KAAK;IAACC,EAAE,EAAC,OAAO;IAACC,OAAO,EAAC,YAAY;IAAAX,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,GAAC,sCAAc,CAAC,eAC7DnF,KAAA,CAAA6E,aAAA,CAACzE,IAAI,CAACsF,KAAK;IACP5B,IAAI,EAAC,MAAM;IACXH,EAAE,EAAC,YAAY;IACfgC,KAAK,EAAE;MAACC,OAAO,EAAE;IAAM,CAAE;IACzBC,QAAQ,EAAE,SAAAA,SAACC,CAAC;MAAA,OAAG/D,QAAQ,CAAC+D,CAAC,CAACC,MAAM,CAACC,KAAK,CAAC,CAAC,CAAC,CAAC;IAAA,CAAC;IAAAlB,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,CAC9C,CAAC,eACFnF,KAAA,CAAA6E,aAAA,CAACzE,IAAI,CAACsF,KAAK;IACPO,WAAW,EAAC,sCAAQ;IACpB/C,KAAK,EAAEpC,KAAM;IACb+E,QAAQ,EAAE,SAAAA,SAACC,CAAC;MAAA,OAAG/E,QAAQ,CAAC+E,CAAC,CAACC,MAAM,CAAC7C,KAAK,CAAC;IAAA,CAAC;IAAA4B,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,CAC3C,CAAC,eACFnF,KAAA,CAAA6E,aAAA,CAACzE,IAAI,CAAC8F,QAAQ;IACVD,WAAW,EAAC,sCAAQ;IACpB/C,KAAK,EAAEhC,OAAQ;IACf2E,QAAQ,EAAE,SAAAA,SAACC,CAAC;MAAA,OAAG3E,UAAU,CAAC2E,CAAC,CAACC,MAAM,CAAC7C,KAAK,CAAC;IAAA,CAAC;IAAA4B,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,CAC7C,CAAC,eACFnF,KAAA,CAAA6E,aAAA,CAACzE,IAAI,CAAC+F,QAAQ;IACVF,WAAW,EAAC,sCAAQ;IACpBnD,OAAO,EAAEA,OAAQ;IACjBsD,SAAS;IACTlD,KAAK,EAAExB,SAAU;IACjBmE,QAAQ,EAAE,SAAAA,SAACC,CAAC,EAAAO,IAAA;MAAA,IAAGnD,KAAK,GAAAmD,IAAA,CAALnD,KAAK;MAAA,OAAIvB,YAAY,CAACuB,KAAK,CAAC;IAAA,CAAC;IAAA4B,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,CAC/C,CAAC,eACFnF,KAAA,CAAA6E,aAAA,CAACzE,IAAI,CAACE,MAAM;IAACgG,OAAO,EAAEpE,SAAU;IAAA4C,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,GAAC,cAAe,CAC9C,CACC,CAAC;AAEpB"},"metadata":{},"sourceType":"module"}